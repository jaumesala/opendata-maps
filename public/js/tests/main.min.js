SITE={common:{init:function(){}},home:{init:function(){}},neighborhoods:{init:function(){}},complains:{init:function(){}},choropleth:{init:function(){}},heatmap:{init:function(){}}},UTIL={exec:function(e,o){var t=SITE,o=void 0===o?"init":o;""!==e&&t[e]&&"function"==typeof t[e][o]&&t[e][o]()},init:function(){var e=document.body,o=e.getAttribute("data-controller").trim(),t=e.getAttribute("data-action").trim();UTIL.exec("common"),UTIL.exec(o),UTIL.exec(o,t)}},$(document).ready(UTIL.init),SITE.complains.index=function(){mapboxgl.accessToken="pk.eyJ1IjoiamF1bWVzYWxhIiwiYSI6ImNpanZ4dmlndDAwNWl2Mm00d3RpY2VweTkifQ.fh0cb8ZJhawwDnZUlZx47Q";var e=new mapboxgl.Map({container:"map",style:"mapbox://styles/jaumesala/cikedqlyp00bbkqlxe7kzopov",center:[4.390819,51.91696],zoom:13,pitch:45,bearing:-20});e.on("style.load",function(){e.addControl(new mapboxgl.Navigation),e.addSource("neighbourhoods",{type:"geojson",data:"http://schiedam-map.app/datasets/neighbourhoods.geojson"}),e.addSource("districts",{type:"geojson",data:"http://schiedam-map.app/datasets/districts.geojson"}),e.addSource("markers",{type:"geojson",data:"http://schiedam-map.app/datasets/complains.geojson"}),e.addLayer({id:"markers",type:"circle",source:"markers",paint:{"circle-radius":2,"circle-color":"#ff442b","circle-opacity":.6}})})},SITE.choropleth.index=function(){mapboxgl.accessToken="pk.eyJ1IjoiamF1bWVzYWxhIiwiYSI6ImNpanZ4dmlndDAwNWl2Mm00d3RpY2VweTkifQ.fh0cb8ZJhawwDnZUlZx47Q";var e=new mapboxgl.Map({container:"map",style:"mapbox://styles/jaumesala/cikedqlyp00bbkqlxe7kzopov",center:[4.390819,51.91696],zoom:13});e.on("style.load",function(){e.addControl(new mapboxgl.Navigation),$.getJSON("http://schiedam-map.app/datasets/neighbourhoods.geojson",function(o){var t=o;$.getJSON("http://schiedam-map.app/datasets/complains.geojson",function(o){var a=o,i=turf.count(t,a,"pt_count"),n={type:"FeatureCollection",features:[]};_.each(t.features,function(e){var o=turf.centroid(e);o.properties=e.properties,n.features.push(o)}),e.addSource("centroidsCount",{type:"geojson",data:n}),e.addSource("neighbourhoods",{type:"geojson",data:i}),e.addSource("districts",{type:"geojson",data:"http://schiedam-map.app/datasets/districts.geojson"}),e.addLayer({id:"nFill",type:"fill",source:"neighbourhoods",interactive:!0,layout:{},paint:{"fill-opacity":0}}),e.addLayer({id:"nFill-hover",type:"fill",source:"neighbourhoods",layout:{},paint:{"fill-color":"#930","fill-opacity":.2},filter:["all",["==","ID","NONE"]]}),e.on("mousemove",function(o){e.featuresAt(o.point,{radius:5,layer:"nFill",includeGeometry:!0},function(o,t){if(o)throw o;var a=t.map(function(e){return e.properties.SLEUTEL});e.setFilter("nFill-hover",["all",["in","SLEUTEL"].concat(a)])})}),e.addLayer({id:"nSymbol",type:"symbol",source:"centroidsCount",layout:{"text-field":"{pt_count}"},paint:{}}),e.addLayer({id:"distLine",type:"line",source:"districts",layout:{},paint:{"line-color":"#926ecc","line-width":2}});var r=chroma.scale("YlOrBr").colors(7),c=turf.jenks(i,"pt_count",6),l=_.zip(r,c).reverse();l.forEach(function(o,t){e.addLayer({id:"layer-"+t,interactive:!0,type:"fill",source:"neighbourhoods",paint:{"fill-color":o[0],"fill-opacity":.2}})}),l.forEach(function(o,t){var a=["all",[">=","pt_count",o[1]]];0!==t&&a.push(["<","pt_count",l[t-1][1]]),e.setFilter("layer-"+t,a)})})})})},SITE.heatmap.index=function(){mapboxgl.accessToken="pk.eyJ1IjoiamF1bWVzYWxhIiwiYSI6ImNpanZ4dmlndDAwNWl2Mm00d3RpY2VweTkifQ.fh0cb8ZJhawwDnZUlZx47Q";var e=new mapboxgl.Map({container:"map",style:"mapbox://styles/jaumesala/cikedqlyp00bbkqlxe7kzopov",center:[4.390819,51.91696],zoom:12,pitch:45,bearing:-20});e.on("style.load",function(){e.addControl(new mapboxgl.Navigation),$.getJSON("http://schiedam-map.app/datasets/complains.geojson",function(o){var t=o,a=[4.335995,51.889074,4.430752,51.966349],i=.2,n="kilometers",r=turf.squareGrid(a,i,n),c=(turf.count(r,t,"pt_count"),{type:"FeatureCollection",features:[]});_.each(r.features,function(e){var o=turf.centroid(e);o.properties=e.properties,c.features.push(o)}),e.addSource("complains",{type:"geojson",data:t}),e.addSource("square-grid",{type:"geojson",data:r}),e.addSource("point-grid",{type:"geojson",data:c});var l=chroma.scale("RdYlBu").colors(5).reverse(),p=turf.jenks(c,"pt_count",4),s=_.zip(l,p);s.forEach(function(o,t){var a=50-8*t,i=.2+.2*t;e.addLayer({id:"pgCircle-"+t,type:"circle",source:"point-grid","source-layer":"water",paint:{"circle-color":o[0],"circle-opacity":i,"circle-radius":a,"circle-blur":1}})}),s.forEach(function(o,t){var a=["all",[">","pt_count",o[1]]];e.setFilter("pgCircle-"+t,a)})})})},SITE.home.index=function(){},SITE.neighborhoods.index=function(){mapboxgl.accessToken="pk.eyJ1IjoiamF1bWVzYWxhIiwiYSI6ImNpanZ4dmlndDAwNWl2Mm00d3RpY2VweTkifQ.fh0cb8ZJhawwDnZUlZx47Q";var e=new mapboxgl.Map({container:"map",style:"mapbox://styles/jaumesala/cikedqlyp00bbkqlxe7kzopov",center:[4.390819,51.92696],zoom:13,pitch:45,bearing:-20});e.on("style.load",function(){e.addSource("neighbourhoods",{type:"geojson",data:"http://schiedam-map.app/datasets/neighbourhoods.geojson"}),e.addSource("districts",{type:"geojson",data:"http://schiedam-map.app/datasets/districts.geojson"}),e.addControl(new mapboxgl.Navigation),e.addLayer({id:"nFill",type:"fill",source:"neighbourhoods",layout:{},interactive:!0,paint:{"fill-color":"#088","fill-opacity":0}}),e.addLayer({id:"nFill-hover",type:"fill",source:"neighbourhoods",layout:{},paint:{"fill-color":"#930","fill-opacity":.2},filter:["all",["==","ID","NONE"]]}),e.addLayer({id:"distLine",type:"line",source:"districts",layout:{},paint:{"line-color":"#926ecc","line-width":2}}),e.on("mousemove",function(o){e.featuresAt(o.point,{radius:5,layer:"nFill",includeGeometry:!0},function(o,t){if(o)throw o;var a=t.map(function(e){return e.properties.SLEUTEL});e.setFilter("nFill-hover",["all",["in","SLEUTEL"].concat(a)])})})})};